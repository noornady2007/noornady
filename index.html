<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SHAHDâ™¡NOOR</title>

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">

<style>
:root{
  --bg1:#240046;
  --bg2:#3c096c;
  --bg3:#10002b;
  --glass:rgba(0, 0, 0, 0.3);
  --text:#fff;
  --btn:#9d4edd;
  --btnText:#fff;
  --gold: #d4af37;
  --body-bg: radial-gradient(circle at top left,#5a189a44,transparent 50%),
             radial-gradient(circle at bottom right,#3c096c44,transparent 50%),
             linear-gradient(135deg,var(--bg1),var(--bg2),var(--bg3));
}

body.light-purple {
  --bg1: #7b2cbf;
  --bg2: #9d4edd;
  --bg3: #c8b6ff;
  --glass: rgba(255, 255, 255, 0.2);
  --text: #fff;
  background: linear-gradient(135deg, #7b2cbf, #9d4edd, #e0aaff) !important;
}

body {
  margin:0;
  font-family:'Cairo',sans-serif;
  color:var(--text);
  min-height:100vh;
  background: var(--body-bg);
  overflow-x: hidden;
  position: relative;
  opacity: 0;
  animation: fadeInSite 1.5s ease forwards;
  transition: background 0.8s ease;
}

@keyframes fadeInSite { to { opacity: 1; } }

.header{
  display:flex; justify-content:space-between; align-items:center; padding:14px;
  position: sticky; top: 0; z-index: 100;
  background: rgba(36, 0, 70, 0.5); backdrop-filter: blur(10px);
}

.icon-btn{
  width:42px;height:42px; border-radius:14px;
  background:rgba(255,255,255,0.1); backdrop-filter: blur(10px);
  display:flex; align-items:center; justify-content:center;
  cursor:pointer; font-size: 18px; position: relative; border: 1px solid rgba(255,255,255,0.1);
  user-select: none;
}

#chatBtn { display: none; }
.header-title{ font-weight:700; font-size:20px; text-shadow: 0 2px 10px rgba(0,0,0,0.5); }

.counter-wrapper { position: relative; padding: 20px 0; }
.counter-container {
  background: rgba(0, 0, 0, 0.5); backdrop-filter: blur(15px);
  margin: 0 16px; padding: 20px; border-radius: 25px; text-align: center;
  border: 1px solid rgba(212, 175, 55, 0.3); box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
  position: relative; z-index: 2;
}
.bg-heart {
  position: absolute; font-size: 18px; animation: pulseHeart 2s infinite ease-in-out; color: #ff4d6d; opacity: 0.6;
}
@keyframes pulseHeart {
  0%, 100% { transform: scale(1); opacity: 0.4; }
  50% { transform: scale(1.3); opacity: 0.8; }
}

.counter-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 5px; }
.counter-item { background: rgba(255,255,255,0.03); padding: 8px 2px; border-radius: 12px; }
.counter-val { font-size: 18px; font-weight: 900; color: var(--gold); }
.counter-label { font-size: 10px; color: #bbb; }

.container{ max-width:430px; margin:auto; padding:16px; position: relative; z-index: 5; }
.hidden{display:none}
input,textarea,button{ width:100%; padding:14px; margin:8px 0; border-radius:14px; border:none; font-family:inherit; box-sizing: border-box; }
input,textarea{ background:rgba(255,255,255,0.08); color:#fff; border: 1px solid rgba(255,255,255,0.1); }
button{ background:var(--btn); color:var(--btnText); font-weight:700; cursor: pointer; transition: 0.3s; }

.card{
  background:var(--glass); backdrop-filter:blur(20px); border-radius:20px; padding:12px; margin-top:18px;
  border: 1px solid rgba(255,255,255,0.05); animation: photoReveal 1.2s cubic-bezier(0.22, 1, 0.36, 1) forwards; opacity: 0;
}
@keyframes photoReveal { 
  0% { opacity: 0; transform: translateY(30px) rotate(-2deg); } 
  100% { opacity: 1; transform: translateY(0) rotate(0deg); } 
}
.card img{ width:100%; border-radius:14px; cursor:pointer; transition:.4s ease; }
.actions { display: flex; gap: 12px; margin-top: 12px; justify-content: flex-end; }
.action-btn { 
  width: 35px; height: 35px; display: flex; align-items: center; justify-content: center;
  background: rgba(255,255,255,0.1); border-radius: 50%; cursor: pointer; transition: 0.3s; 
}
.action-btn:hover { background: var(--btn); transform: translateY(-3px); }

.viewer{ 
  position:fixed; inset:0; background:rgba(0,0,0,0); backdrop-filter: blur(0px); 
  display:flex; align-items:center; justify-content:center; z-index:10000; 
  transition: background 0.6s ease, backdrop-filter 0.6s ease;
}
.viewer.active { background:rgba(0,0,0,0.6); backdrop-filter: blur(15px); }
.viewer img, .viewer video { 
  max-width:90%; max-height:85%; border-radius:15px; 
  transform: scale(0.5) rotate(-15deg); opacity: 0;
  transition: transform 0.8s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.6s ease; 
}
.viewer.active img, .viewer.active video { transform: scale(1) rotate(0deg); opacity: 1; }
.viewer.closing img, .viewer.closing video { transform: scale(0.5) rotate(15deg); opacity: 0; }

#chatWindow {
  position: fixed; inset:0; background: rgba(16, 0, 43, 0.98); backdrop-filter: blur(25px);
  z-index: 2000; display: none; flex-direction: column;
}
#chatMessages { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 12px; }
.msg { max-width: 75%; padding: 12px 16px; border-radius: 20px; font-size: 14px; position: relative; }
.msg.sent { align-self: flex-end; background: linear-gradient(135deg, #9d4edd, #7b2cbf); color: white; border-bottom-right-radius: 4px; }
.msg.received { align-self: flex-start; background: rgba(255,255,255,0.1); color: white; border-bottom-left-radius: 4px; }
.msg img, .msg video { max-width: 100%; border-radius: 10px; margin-top: 5px; display: block; }

.del-msg {
  position: absolute; top: -8px; left: -8px; background: #ff4d6d; color: white;
  width: 20px; height: 20px; border-radius: 50%; font-size: 12px;
  display: flex; align-items: center; justify-content: center; cursor: pointer; opacity: 0; transition: 0.3s;
}
.msg:hover .del-msg { opacity: 1; }
.chat-input-area { padding: 15px; background: #10002b; display: flex; gap: 10px; align-items: center; }

#addBox.hide { max-height:0; opacity:0; overflow:hidden; transition: 0.6s; }
#addBox.show { max-height:600px; opacity:1; transition: 0.6s; }

.click-heart {
  position: fixed;
  pointer-events: none;
  z-index: 1500;
  font-size: 16px;
  color: #fff;
  animation: floatHeart 2.5s ease-out forwards;
  white-space: nowrap;
  text-shadow: 0 0 8px rgba(255, 77, 109, 0.8);
}

@keyframes floatHeart {
  0% { transform: translateY(0) scale(0.5); opacity: 0; }
  20% { opacity: 1; transform: translateY(-20px) scale(1.1); }
  100% { transform: translateY(-100px) scale(1); opacity: 0; }
}

</style>
</head>
<body>

<div class="header">
  <div style="display: flex; gap: 10px;">
    <div class="icon-btn" id="moonToggle" onclick="toggleMoon()">ğŸŒ™</div>
    <div class="icon-btn" id="chatBtn" onclick="toggleChat()">ğŸ’¬</div>
  </div>
  <div class="header-title">SHAHDâ™¡NOOR ğŸ’œ</div>
  <div class="icon-btn" onclick="toggleAdd()">â‹®</div>
</div>

<div id="login" class="container">
  <input type="password" id="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±">
  <button onclick="login()">Ø¯Ø®ÙˆÙ„</button>
</div>

<div id="app" class="container hidden">
  <div class="counter-wrapper">
    <div class="bg-heart" style="top:0; left:10px;">â¤ï¸</div>
    <div class="bg-heart" style="bottom:0; right:10px;">ğŸ’–</div>
    <div class="counter-container">
      <div id="counterTitle" style="margin-bottom:10px">Ø¨Ù‚Ø§Ù„Ù†Ø§ Ù…Ø¹ Ø¨Ø¹Ø¶ ÙŠØ§ Ø±ÙˆØ­ÙŠ â¤ï¸</div>
      <div class="counter-grid" id="timer">
        <div class="counter-item"><span class="counter-val" id="months">0</span><br><span class="counter-label">Ø´Ù‡Ø±</span></div>
        <div class="counter-item"><span class="counter-val" id="days">0</span><br><span class="counter-label">ÙŠÙˆÙ…</span></div>
        <div class="counter-item"><span class="counter-val" id="hours">0</span><br><span class="counter-label">Ø³Ø§Ø¹Ø©</span></div>
        <div class="counter-item"><span class="counter-val" id="minutes">0</span><br><span class="counter-label">Ø¯Ù‚ÙŠÙ‚Ø©</span></div>
        <div class="counter-item"><span class="counter-val" id="seconds">0</span><br><span class="counter-label">Ø«Ø§Ù†ÙŠØ©</span></div>
      </div>
    </div>
  </div>

  <div id="addBox" class="hide">
    <input type="file" id="image" accept="image/*">
    <input type="date" id="date">
    <textarea id="desc" placeholder="ÙˆØµÙ Ø§Ù„ØµÙˆØ±Ø©"></textarea>
    <button id="addPhotoBtn" onclick="addPhoto()">Ø¥Ø¶Ø§ÙØ© ØµÙˆØ±Ø©</button>
  </div>
  <div id="gallery"></div>
</div>

<div id="chatWindow">
  <div style="padding: 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid rgba(255,255,255,0.1);">
    <span>Ø´Ø§Øª Ø§Ù„Ù‚Ù„ÙˆØ¨ ğŸ’•</span>
    <div class="icon-btn" onclick="toggleChat()">âœ–ï¸</div>
  </div>
  <div id="chatMessages"></div>
  <div class="chat-input-area">
    <label for="chatFile" class="icon-btn" style="font-size: 20px;">ğŸ“</label>
    <input type="file" id="chatFile" accept="image/*,video/*" style="display:none" onchange="sendMedia(this)">
    <input type="text" id="chatMsg" placeholder="Ø§ÙƒØªØ¨ÙŠ Ø­Ø§Ø¬Ø©...">
    <button onclick="sendMsg()" style="width: auto;">Ø¥Ø±Ø³Ø§Ù„</button>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, updateDoc, onSnapshot, query, orderBy, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBuSYBywG6Jn-pTaqkKEDcbYeORukEh1pU",
  authDomain: "noor-25be7.firebaseapp.com",
  projectId: "noor-25be7",
  storageBucket: "noor-25be7.firebasestorage.app",
  messagingSenderId: "245021407626",
  appId: "1:245021407626:web:e4ce8a4d4a5a160831b073"
};

const appFirebase = initializeApp(firebaseConfig);
const db = getFirestore(appFirebase);

const REAL_PASSWORD = "25102007";
// Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø·Ù„ÙˆØ¨: 29/11/2025 Ø§Ù„Ø³Ø§Ø¹Ø© 11:30 Ù…Ø³Ø§Ø¡Ù‹ (Ø´Ù‡Ø± 10 Ù„Ø£Ù† Ø§Ù„Ø´Ù‡ÙˆØ± ØªØ¨Ø¯Ø£ Ù…Ù† 0)
const relationshipDate = new Date(2025, 10, 29, 23, 30); 

window.login = () => {
  if (document.getElementById("password").value === REAL_PASSWORD) {
    document.getElementById("login").classList.add("hidden");
    document.getElementById("app").classList.remove("hidden");
    document.getElementById('chatBtn').style.display = 'flex';
    loadPhotos(); startCounter(); listenMessages();
  } else alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ØºÙ„Ø·");
}

function startCounter() {
  setInterval(() => {
    const now = new Date();
    const diff = now - relationshipDate;
    
    // Ù„Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ Ø£Ùˆ Ø§Ù„ØªØµØ§Ø¹Ø¯ÙŠ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­
    const absoluteDiff = Math.abs(diff);
    
    document.getElementById("months").innerText = Math.floor(absoluteDiff / (1000 * 60 * 60 * 24 * 30.44));
    document.getElementById("days").innerText = Math.floor((absoluteDiff / (1000 * 60 * 60 * 24)) % 30.44);
    document.getElementById("hours").innerText = Math.floor((absoluteDiff / (1000 * 60 * 60)) % 24);
    document.getElementById("minutes").innerText = Math.floor((absoluteDiff / (1000 * 60)) % 60);
    document.getElementById("seconds").innerText = Math.floor((absoluteDiff / 1000) % 60);
    
    if(diff < 0) {
        document.getElementById("counterTitle").innerText = "ÙØ§Ø¶Ù„ Ø¹Ù„Ù‰ ÙˆØ¹Ø¯Ù†Ø§ â¤ï¸";
    } else {
        document.getElementById("counterTitle").innerText = "Ø¨Ù‚Ø§Ù„Ù†Ø§ Ù…Ø¹ Ø¨Ø¹Ø¶ ÙŠØ§ Ø±ÙˆØ­ÙŠ â¤ï¸";
    }
  }, 1000);
}

window.sendMsg = async () => {
  const input = document.getElementById('chatMsg');
  if(!input.value.trim()) return;
  await addDoc(collection(db, "chat"), { text: input.value, time: Date.now(), sender: 'user', type: 'text' });
  input.value = "";
}

window.sendMedia = (input) => {
    const file = input.files[0];
    if(!file) return;
    const reader = new FileReader();
    reader.onload = async () => {
        const type = file.type.startsWith('image') ? 'image' : 'video';
        await addDoc(collection(db, "chat"), { 
            media: reader.result, 
            time: Date.now(), 
            sender: 'user', 
            type: type 
        });
    };
    reader.readAsDataURL(file);
    input.value = "";
}

function listenMessages() {
  const q = query(collection(db, "chat"), orderBy("time", "asc"));
  onSnapshot(q, (snap) => {
    const msgsDiv = document.getElementById('chatMessages');
    msgsDiv.innerHTML = "";
    snap.forEach(docSnap => {
      const d = docSnap.data();
      const div = document.createElement('div');
      div.className = d.sender === 'user' ? "msg sent" : "msg received";
      
      let content = `<div class="del-msg" onclick="window.deleteMessage('${docSnap.id}')">ğŸ—‘</div>`;
      if(d.type === 'text') content += `<div>${d.text}</div>`;
      else if(d.type === 'image') content += `<img src="${d.media}" onclick="window.openImg('${d.media}')">`;
      else if(d.type === 'video') content += `<video src="${d.media}" controls></video>`;
      
      div.innerHTML = content;
      msgsDiv.appendChild(div);
    });
    msgsDiv.scrollTop = msgsDiv.scrollHeight;
  });
}

window.deleteMessage = async (id) => { if(confirm("Ø­Ø°Ù Ø§Ù„Ø±Ø³Ø§Ù„Ø©ØŸ")) await deleteDoc(doc(db, "chat", id)); }
window.toggleChat = () => { const win = document.getElementById('chatWindow'); win.style.display = (win.style.display === 'flex') ? 'none' : 'flex'; }

window.toggleMoon = () => {
  document.body.classList.toggle('light-purple');
  const moonBtn = document.getElementById('moonToggle');
  moonBtn.innerText = document.body.classList.contains('light-purple') ? 'âœ¨' : 'ğŸŒ™';
}

document.addEventListener('click', (e) => {
  if (e.target.closest('button') || e.target.closest('.icon-btn') || e.target.closest('input') || e.target.closest('#chatWindow') || e.target.closest('.msg')) return;
  const heart = document.createElement('div');
  heart.className = 'click-heart';
  heart.innerHTML = 'Ø¨Ø­Ø¨Ùƒ ÙŠ Ø´Ù‡ÙˆØ¯ØªÙŠğŸ’•ğŸŒš';
  heart.style.left = (e.clientX - 50) + 'px';
  heart.style.top = (e.clientY - 10) + 'px';
  document.body.appendChild(heart);
  setTimeout(() => heart.remove(), 2500);
});

window.toggleAdd = () => { addBox.classList.toggle("show"); addBox.classList.toggle("hide"); }

window.addPhoto = () => {
  const file = document.getElementById("image").files[0];
  const dateVal = document.getElementById("date").value;
  if (!file || !dateVal) return alert("Ø§Ø®ØªØ± Ø§Ù„ØµÙˆØ±Ø© ÙˆØ§Ù„ØªØ§Ø±ÙŠØ®");
  const reader = new FileReader();
  reader.onload = async () => {
    await addDoc(collection(db, "images"), { 
      img: reader.result, 
      date: dateVal, 
      desc: document.getElementById("desc").value, 
      createdAt: Date.now() 
    });
    loadPhotos(); toggleAdd();
  };
  reader.readAsDataURL(file);
}

async function loadPhotos() {
  const gallery = document.getElementById("gallery");
  gallery.innerHTML = "<p style='text-align:center'>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø°ÙƒØ±ÙŠØ§Øª...</p>";
  const snap = await getDocs(collection(db, "images"));
  let photos = [];
  snap.forEach(d => photos.push({ id: d.id, ...d.data() }));
  photos.sort((a, b) => new Date(b.date) - new Date(a.date));
  gallery.innerHTML = "";
  photos.forEach((p, index) => {
    const card = document.createElement('div');
    card.className = 'card';
    card.id = `card-${p.id}`;
    card.style.animationDelay = `${index * 0.1}s`;
    card.innerHTML = `
      <img src="${p.img}" onclick="window.openImg('${p.img}')">
      <div class="card-content">
        <div style="font-size:12px; color:var(--gold); margin-top:8px;">ğŸ“… ${p.date || "Ø¨Ø¯ÙˆÙ† ØªØ§Ø±ÙŠØ®"}</div>
        <div style="font-weight:bold; margin-top:5px;">${p.desc || ""}</div>
      </div>
      <div class="actions">
        <div class="action-btn" onclick="window.startEdit('${p.id}')">âœï¸</div>
        <div class="action-btn" onclick="window.deletePhoto('${p.id}')">ğŸ—‘</div>
      </div>`;
    gallery.appendChild(card);
  });
}

window.startEdit = async (id) => {
  const pass = prompt("ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ù„Ù„ØªØ¹Ø¯ÙŠÙ„");
  if (pass !== REAL_PASSWORD) return pass !== null ? alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ØºÙ„Ø·") : null;
  const docRef = doc(db, "images", id);
  const docSnap = await getDoc(docRef);
  if (!docSnap.exists()) return;
  const data = docSnap.data();
  const card = document.getElementById(`card-${id}`);
  const contentDiv = card.querySelector('.card-content');
  contentDiv.innerHTML = `
    <input type="text" id="edit-desc-${id}" value="${data.desc}" placeholder="Ø§Ù„ÙˆØµÙ">
    <input type="date" id="edit-date-${id}" value="${data.date}">
    <button onclick="window.saveEdit('${id}')" style="background:var(--gold); color:#000; padding:8px;">Ø­ÙØ¸ âœ…</button>
    <button onclick="window.loadPhotos()" style="background:none; border:1px solid #fff; color:#fff; padding:8px;">Ø¥Ù„ØºØ§Ø¡</button>
  `;
}

window.saveEdit = async (id) => {
  const newDesc = document.getElementById(`edit-desc-${id}`).value;
  const newDate = document.getElementById(`edit-date-${id}`).value;
  await updateDoc(doc(db, "images", id), { desc: newDesc, date: newDate });
  window.loadPhotos();
}

window.deletePhoto = async (id) => {
  const pass = prompt("ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ù„Ù„Ù…Ø³Ø­");
  if (pass !== REAL_PASSWORD) return pass !== null ? alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ØºÙ„Ø·") : null;
  if(confirm("Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø°ÙƒØ±Ù‰ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ")) {
    await deleteDoc(doc(db, "images", id));
    window.loadPhotos();
  }
}

window.openImg = src => {
  const v = document.createElement("div");
  v.className = "viewer"; v.innerHTML = `<img src="${src}">`;
  document.body.appendChild(v);
  setTimeout(() => v.classList.add("active"), 10);
  v.onclick = () => { 
    v.classList.remove("active"); v.classList.add("closing");
    setTimeout(() => v.remove(), 800); 
  };
}

window.loadPhotos = loadPhotos;
</script>
</body>
</html>

