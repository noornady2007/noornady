<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SHAHDâ™¡NOOR</title>

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">

<style>
:root{
  --bg1:#240046;
  --bg2:#3c096c;
  --bg3:#10002b;
  --glass:rgba(0, 0, 0, 0.3);
  --text:#fff;
  --btn:#9d4edd;
  --btnText:#fff;
  --gold: #d4af37;
}

body{
  margin:0;
  font-family:'Cairo',sans-serif;
  color:var(--text);
  min-height:100vh;
  background:
    radial-gradient(circle at top left,#5a189a44,transparent 50%),
    radial-gradient(circle at bottom right,#3c096c44,transparent 50%),
    linear-gradient(135deg,var(--bg1),var(--bg2),var(--bg3));
  transition:background 1s ease;
  overflow-x: hidden;
  position: relative;
  opacity: 0;
  animation: fadeInSite 1.5s ease forwards;
}

@keyframes fadeInSite {
  to { opacity: 1; }
}

body.light{
  --bg1:#f2e9fb;
  --bg2:#e0aaff;
  --bg3:#c77dff;
  --text:#240046;
}

/* ===== Header ===== */
.header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:14px;
  position: sticky;
  top: 0;
  z-index: 100;
  background: rgba(36, 0, 70, 0.5);
  backdrop-filter: blur(10px);
}

.icon-btn{
  width:42px;height:42px;
  border-radius:14px;
  background:rgba(255,255,255,0.1);
  backdrop-filter: blur(10px);
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  font-size: 18px;
  position: relative;
  border: 1px solid rgba(255,255,255,0.1);
}

.notification-dot {
  position: absolute;
  top: -2px;
  right: -2px;
  width: 10px;
  height: 10px;
  background-color: #ff4d6d;
  border: 2px solid var(--bg1);
  border-radius: 50%;
  display: none;
  animation: pulse 1.5s infinite;
}

@keyframes pulse {
  0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 77, 109, 0.7); }
  70% { transform: scale(1.2); box-shadow: 0 0 0 10px rgba(255, 77, 109, 0); }
  100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 77, 109, 0); }
}

#chatBtn { display: none; }
.header-title{ font-weight:700; font-size:20px; text-shadow: 0 2px 10px rgba(0,0,0,0.5); }

/* ===== Counter Styling ===== */
.counter-wrapper { position: relative; padding: 20px 0; }
.counter-container {
  background: rgba(0, 0, 0, 0.5);
  backdrop-filter: blur(15px);
  margin: 0 16px;
  padding: 20px;
  border-radius: 25px;
  text-align: center;
  border: 1px solid rgba(212, 175, 55, 0.3);
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
  position: relative;
  z-index: 2;
}

.bg-heart {
  position: absolute;
  font-size: 18px;
  animation: pulseHeart 2s infinite ease-in-out;
  color: #ff4d6d;
  opacity: 0.6;
}

@keyframes pulseHeart {
  0%, 100% { transform: scale(1); opacity: 0.4; }
  50% { transform: scale(1.3); opacity: 0.8; }
}

.counter-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 5px; }
.counter-item {
  background: rgba(255,255,255,0.03);
  padding: 8px 2px;
  border-radius: 12px;
}

.counter-val { font-size: 18px; font-weight: 900; color: var(--gold); }
.counter-label { font-size: 10px; color: #bbb; }

/* ===== Containers ===== */
.container{ max-width:430px; margin:auto; padding:16px; position: relative; z-index: 5; }
.hidden{display:none}

input,textarea,button{
  width:100%; padding:14px; margin:8px 0; border-radius:14px; border:none;
  font-family:inherit; box-sizing: border-box;
}

input,textarea{ background:rgba(255,255,255,0.08); color:#fff; border: 1px solid rgba(255,255,255,0.1); }
button{ background:var(--btn); color:var(--btnText); font-weight:700; cursor: pointer; transition: 0.3s; }
button:active { transform: scale(0.98); }

/* ===== Progress Bar ===== */
#uploadProgressContainer {
  width: 100%; background: rgba(255, 255, 255, 0.1); border-radius: 10px; height: 8px; margin: 10px 0; display: none; overflow: hidden;
}
#uploadProgressBar {
  width: 0%; height: 100%; background: linear-gradient(90deg, var(--gold), #ff4d6d); transition: width 0.3s ease;
}
.success-msg {
  color: #00ffcc; font-size: 14px; text-align: center; margin-top: 5px; display: none; font-weight: bold;
}

/* ===== Add Box ===== */
#addBox{ overflow:hidden; transition:.6s cubic-bezier(0.4, 0, 0.2, 1); }
#addBox.hide{max-height:0; opacity:0; transform:translateY(-10px)}
#addBox.show{max-height:600px; opacity:1; transform:translateY(0)}

/* ===== Cards & Photos ===== */
.card{
  background:var(--glass);
  backdrop-filter:blur(20px);
  border-radius:20px;
  padding:12px;
  margin-top:18px;
  border: 1px solid rgba(255,255,255,0.05);
  animation: photoReveal 1.2s cubic-bezier(0.22, 1, 0.36, 1) forwards;
  opacity: 0;
}

@keyframes photoReveal {
  0% { opacity: 0; transform: translateY(30px) rotate(-2deg) scale(0.95); }
  100% { opacity: 1; transform: translateY(0) rotate(0deg) scale(1); }
}

.card img{ width:100%; border-radius:14px; cursor:pointer; transition:.4s ease; }
.card img:hover { transform: scale(1.02); }

.actions { display: flex; gap: 12px; margin-top: 12px; justify-content: flex-end; }
.action-btn { 
  width: 35px; height: 35px; 
  display: flex; align-items: center; justify-content: center;
  background: rgba(255,255,255,0.1);
  border-radius: 50%;
  cursor: pointer; transition: 0.3s; 
  box-shadow: 0 4px 10px rgba(0,0,0,0.2);
}
.action-btn:hover { background: var(--btn); transform: translateY(-3px); }

/* ===== Ø¹Ø§Ø±Ø¶ Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…Ø·ÙˆØ± Ù…Ø¹ Ø§Ù„Ø¯ÙˆØ±Ø§Ù† Ø§Ù„Ø³Ù„Ø³ ===== */
.viewer{ 
  position:fixed; inset:0; 
  background:rgba(0,0,0,0); /* Ø³ØªØ¨Ø¯Ø£ Ø´ÙØ§ÙØ© */
  backdrop-filter: blur(0px); /* Ø³ÙŠØ¨Ø¯Ø£ Ø§Ù„Ø·Ù…Ø³ Ù…Ù† Ø§Ù„ØµÙØ± */
  display:flex; align-items:center; justify-content:center; 
  z-index:10000; 
  transition: background 0.6s ease, backdrop-filter 0.6s ease;
}

.viewer.active {
  background:rgba(0,0,0,0.6);
  backdrop-filter: blur(15px);
}

.viewer img{ 
  max-width:90%; max-height:85%; border-radius:15px; 
  box-shadow: 0 20px 60px rgba(0,0,0,0.5);
  transform: scale(0.5) rotate(-15deg); /* Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©: ØµØºÙŠØ±Ø© ÙˆÙ…Ø¯ÙˆØ±Ø© */
  opacity: 0;
  transition: transform 0.8s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.6s ease; 
}

.viewer.active img {
  transform: scale(1) rotate(0deg); /* Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©: Ø­Ø¬Ù… Ø·Ø¨ÙŠØ¹ÙŠ ÙˆØ¯ÙˆØ±Ø§Ù† Ù…Ø³ØªÙˆÙŠ */
  opacity: 1;
}

.viewer.closing img {
  transform: scale(0.5) rotate(15deg); /* Ø¹Ù†Ø¯ Ø§Ù„Ø¥ØºÙ„Ø§Ù‚: ØªØ¯ÙˆØ± Ù„Ù„Ø¬Ù‡Ø© Ø§Ù„Ø£Ø®Ø±Ù‰ ÙˆØªØµØºØ± */
  opacity: 0;
}

/* ===== Chat System ===== */
#chatWindow {
  position: fixed; bottom: 0; left: 0; right: 0; top: 0;
  background: rgba(16, 0, 43, 0.98);
  backdrop-filter: blur(25px);
  z-index: 2000; display: none; flex-direction: column;
}

#chatMessages { 
  flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 12px; 
  background: rgba(255,255,255,0.02);
}

.msg { max-width: 75%; padding: 12px 16px; border-radius: 20px; font-size: 14px; position: relative; line-height: 1.5; cursor: pointer; }

/* ÙŠÙ…ÙŠÙ† (Ø£Ù†Ø§) */
.msg.sent { 
  align-self: flex-end; 
  background: linear-gradient(135deg, #9d4edd, #7b2cbf); 
  color: white; 
  border-bottom-right-radius: 4px;
  box-shadow: 0 4px 15px rgba(157, 78, 221, 0.3);
  text-align: right;
}

/* Ø´Ù…Ø§Ù„ (Ø§Ù„Ø·Ø±Ù Ø§Ù„ØªØ§Ù†ÙŠ) */
.msg.received { 
  align-self: flex-start; 
  background: rgba(255,255,255,0.1); 
  color: white; 
  border-bottom-left-radius: 4px;
  text-align: left;
}

.chat-input-area { padding: 15px; background: #10002b; display: flex; gap: 10px; align-items: center; }
.chat-input-area input[type="text"] { margin: 0; flex: 1; background: rgba(255,255,255,0.05); }

/* Ø§Ù„Ù‚Ù„ÙˆØ¨ Ø§Ù„Ø·Ø§Ø¦Ø±Ø© */
.heart-pop{
  position:fixed; color:#ff4d6d; font-size:20px; pointer-events:none; z-index: 9999;
  animation:popOutQuiet 2s ease-out forwards;
}
.love-text-pop{
  position:fixed; font-size:14px; color:rgba(255,255,255,0.8); pointer-events:none; z-index: 9999;
  animation:textFloatQuiet 2s ease-out forwards; white-space: nowrap;
}

@keyframes popOutQuiet {
  0%{ transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
  20%{ opacity: 1; }
  100%{ transform: translate(-50%, -100px) scale(1.2); opacity: 0; }
}
@keyframes textFloatQuiet {
  0% { transform: translate(-50%, -50%); opacity: 0; }
  20%{ opacity: 1; }
  100% { transform: translate(-50%, -80px); opacity: 0; }
}

</style>
</head>

<body>

<div id="notify" style="position:fixed; top:20px; left:50%; transform:translateX(-50%); background:var(--gold); color:#000; padding:10px 20px; border-radius:50px; font-weight:bold; z-index:10001; display:none;">Ø±Ø³Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© ÙŠØ§ Ø±ÙˆØ­ÙŠ! â¤ï¸</div>

<div class="header">
  <div style="display: flex; gap: 10px;">
    <div class="icon-btn" onclick="toggleTheme()">ğŸŒ™</div>
    <div class="icon-btn" id="chatBtn" onclick="toggleChat()">
      ğŸ’¬
      <span id="chatDot" class="notification-dot"></span>
    </div>
  </div>
  <div class="header-title">SHAHDâ™¡NOOR ğŸ’œ</div>
  <div class="icon-btn" onclick="toggleAdd()">â‹®</div>
</div>

<div id="login" class="container">
  <input type="text" id="username" placeholder="Ø§Ø³Ù…Ùƒ (Ù†ÙˆØ± Ø£Ùˆ Ø´Ù‡Ø¯)">
  <input type="password" id="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±">
  <button onclick="login()">Ø¯Ø®ÙˆÙ„</button>
</div>

<div id="app" class="container hidden">
  <div class="counter-wrapper">
    <div class="bg-heart" style="top:0; left:10px;">â¤ï¸</div>
    <div class="bg-heart" style="bottom:0; right:10px;">ğŸ’–</div>
    
    <div class="counter-container">
      <div class="counter-title" id="counterTitle">Ø¨Ù‚Ø§Ù„Ù†Ø§ Ù…Ø¹ Ø¨Ø¹Ø¶ ÙŠØ§ Ø±ÙˆØ­ÙŠ â¤ï¸</div>
      <div class="counter-grid" id="timer">
        <div class="counter-item"><span class="counter-val" id="months">0</span><span class="counter-label">Ø´Ù‡Ø±</span></div>
        <div class="counter-item"><span class="counter-val" id="days">0</span><span class="counter-label">ÙŠÙˆÙ…</span></div>
        <div class="counter-item"><span class="counter-val" id="hours">0</span><span class="counter-label">Ø³Ø§Ø¹Ø©</span></div>
        <div class="counter-item"><span class="counter-val" id="minutes">0</span><span class="counter-label">Ø¯Ù‚ÙŠÙ‚Ø©</span></div>
        <div class="counter-item"><span class="counter-val" id="seconds">0</span><span class="counter-label">Ø«Ø§Ù†ÙŠØ©</span></div>
      </div>
    </div>
  </div>

  <div id="addBox" class="hide">
    <input type="file" id="image" accept="image/*">
    <input type="date" id="date">
    <textarea id="desc" placeholder="ÙˆØµÙ Ø§Ù„ØµÙˆØ±Ø©"></textarea>
    <div id="uploadProgressContainer"><div id="uploadProgressBar"></div></div>
    <div id="uploadStatus" class="success-msg">ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø°ÙƒØ±Ù‰ ğŸ¥°ğŸ’•</div>
    <button id="addPhotoBtn" onclick="addPhoto()">Ø¥Ø¶Ø§ÙØ© ØµÙˆØ±Ø©</button>
  </div>
  <div id="gallery"></div>
</div>

<div id="chatWindow">
  <div style="padding: 20px; border-bottom: 1px solid rgba(255,255,255,0.1); display: flex; justify-content: space-between; align-items: center;">
    <span style="font-weight: bold; font-size: 18px;">Ø´Ø§Øª Ø§Ù„Ù‚Ù„ÙˆØ¨ ğŸ’•</span>
    <div class="icon-btn" onclick="toggleChat()">âœ–ï¸</div>
  </div>
  <div id="chatMessages"></div>
  <div class="chat-input-area">
    <label for="chatFile" style="cursor:pointer; font-size: 20px; padding: 0 10px;">ğŸ“</label>
    <input type="file" id="chatFile" accept="image/*,video/*" style="display:none">
    <input type="text" id="chatMsg" placeholder="Ø§ÙƒØªØ¨ÙŠ Ø­Ø§Ø¬Ø©...">
    <button onclick="sendMsg()" style="width: auto; padding: 10px 25px; margin: 0;">Ø¥Ø±Ø³Ø§Ù„</button>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, updateDoc, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBuSYBywG6Jn-pTaqkKEDcbYeORukEh1pU",
  authDomain: "noor-25be7.firebaseapp.com",
  projectId: "noor-25be7",
  storageBucket: "noor-25be7.firebasestorage.app",
  messagingSenderId: "245021407626",
  appId: "1:245021407626:web:e4ce8a4d4a5a160831b073"
};

const appFirebase = initializeApp(firebaseConfig);
const db = getFirestore(appFirebase);

const REAL_PASSWORD = "25102007";
const relationshipDate = new Date(2025, 10, 29, 23, 30); 

const loginDiv = document.getElementById("login");
const appDiv = document.getElementById("app");
const gallery = document.getElementById("gallery");
const addBox = document.getElementById("addBox");
let isLoggedIn = false;
let isInitialLoad = true;
let currentUser = ""; // Ù„Ø­ÙØ¸ Ù…Ù† ÙŠØ³Ø¬Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„

window.login = () => {
  const user = document.getElementById("username").value.trim();
  if (document.getElementById("password").value === REAL_PASSWORD && user !== "") {
    currentUser = user;
    loginDiv.classList.add("hidden");
    appDiv.classList.remove("hidden");
    isLoggedIn = true;
    loadPhotos();
    startCounter();
    enableGlobalHearts();
    listenMessages();
    document.getElementById('chatBtn').style.display = 'flex';
  } else alert("ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø§Ø³Ù… ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±");
}

function startCounter() {
  setInterval(() => {
    const now = new Date();
    let diff = now - relationshipDate;
    let isFuture = diff < 0;
    let absDiff = Math.abs(diff);
    let totalSeconds = Math.floor(absDiff / 1000);
    let seconds = totalSeconds % 60;
    let totalMinutes = Math.floor(totalSeconds / 60);
    let minutes = totalMinutes % 60;
    let totalHours = Math.floor(totalMinutes / 60);
    let hours = totalHours % 24;
    let totalDays = Math.floor(totalHours / 24);
    let months = Math.floor(totalDays / 30.44);
    let days = Math.floor(totalDays % 30.44);
    document.getElementById("months").innerText = months;
    document.getElementById("days").innerText = days;
    document.getElementById("hours").innerText = hours;
    document.getElementById("minutes").innerText = minutes;
    document.getElementById("seconds").innerText = seconds;
    document.getElementById('counterTitle').innerText = isFuture ? "Ø¨Ø§Ù‚ÙŠ Ø¹Ù„Ù‰ Ø§Ø±ØªØ¨Ø§Ø·Ù†Ø§ ÙŠØ§ Ø±ÙˆØ­ÙŠ â¤ï¸" : "Ø¨Ù‚Ø§Ù„Ù†Ø§ Ù…Ø¹ Ø¨Ø¹Ø¶ ÙŠØ§ Ø±ÙˆØ­ÙŠ â¤ï¸";
  }, 1000);
}

function enableGlobalHearts() {
  document.addEventListener('click', (e) => {
    if (!isLoggedIn || e.target.closest('#chatWindow') || e.target.closest('.icon-btn') || e.target.closest('.viewer') || e.target.closest('button') || e.target.closest('input') || e.target.closest('textarea')) return;
    const heart = document.createElement('div');
    heart.className = 'heart-pop';
    heart.innerHTML = 'â¤ï¸';
    heart.style.left = e.clientX + 'px'; heart.style.top = e.clientY + 'px';
    document.body.appendChild(heart);
    const text = document.createElement('div');
    text.className = 'love-text-pop';
    text.innerHTML = 'Ø¨Ø­Ø¨Ùƒ ÙŠØ§ Ø´Ù‡ÙˆØ¯ØªÙŠ ğŸ’•ğŸŒš';
    text.style.left = e.clientX + 'px'; text.style.top = (e.clientY - 20) + 'px';
    document.body.appendChild(text);
    setTimeout(() => { heart.remove(); text.remove(); }, 2000);
  });
}

window.toggleChat = () => {
  const win = document.getElementById('chatWindow');
  const dot = document.getElementById('chatDot');
  if (win.style.display === 'flex') {
    win.style.display = 'none';
    document.body.style.overflow = "auto";
  } else {
    win.style.display = 'flex';
    dot.style.display = 'none';
    document.body.style.overflow = "hidden";
  }
}

window.sendMsg = async () => {
  const input = document.getElementById('chatMsg');
  const fileInput = document.getElementById('chatFile');
  const text = input.value.trim();
  const file = fileInput.files[0];
  if(!text && !file) return;
  
  if(file) {
    const reader = new FileReader();
    reader.onload = async () => {
      await addDoc(collection(db, "chat"), { 
        text, 
        file: reader.result, 
        type: file.type.split('/')[0], 
        time: Date.now(), 
        sender: currentUser 
      });
    };
    reader.readAsDataURL(file);
  } else {
    await addDoc(collection(db, "chat"), { 
      text, 
      time: Date.now(), 
      sender: currentUser 
    });
  }
  input.value = ""; fileInput.value = "";
}

window.deleteMsg = async (id) => {
  if (prompt("Ø§ÙƒØªØ¨ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ù„Ù„Ø­Ø°Ù") === REAL_PASSWORD) {
    await deleteDoc(doc(db, "chat", id));
  }
}

function listenMessages() {
  const q = query(collection(db, "chat"), orderBy("time", "asc"));
  onSnapshot(q, (snap) => {
    const msgsDiv = document.getElementById('chatMessages');
    const dot = document.getElementById('chatDot');
    msgsDiv.innerHTML = "";
    snap.forEach(docSnap => {
      const d = docSnap.data();
      const div = document.createElement('div');
      // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø±Ø³Ù„ Ù‡Ùˆ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ ØªØ¸Ù‡Ø± ÙŠÙ…ÙŠÙ† (sent)ØŒ ØºÙŠØ± Ø°Ù„Ùƒ Ø´Ù…Ø§Ù„ (received)
      div.className = d.sender === currentUser ? "msg sent" : "msg received";
      div.onclick = () => deleteMsg(docSnap.id);
      
      let content = `<div>${d.text || ""}</div>`;
      if(d.file) {
        if(d.type === 'image') content += `<img src="${d.file}" style="width:100%; border-radius:10px; margin-top:5px;" onclick="window.openImg('${d.file}')">`;
        else if(d.type === 'video') content += `<video src="${d.file}" controls style="width:100%; border-radius:10px;"></video>`;
      }
      div.innerHTML = content;
      msgsDiv.appendChild(div);
    });
    msgsDiv.scrollTop = msgsDiv.scrollHeight;
    if(!isInitialLoad && snap.docChanges().some(change => change.type === "added")) {
        const n = document.getElementById('notify');
        n.style.display = 'block'; setTimeout(() => n.style.display = 'none', 3000);
        if (document.getElementById('chatWindow').style.display !== 'flex') { dot.style.display = 'block'; }
    }
    isInitialLoad = false;
  });
}

window.toggleAdd = () => { addBox.classList.toggle("show"); addBox.classList.toggle("hide"); }
window.toggleTheme = () => {
  document.body.classList.toggle("light");
  localStorage.theme = document.body.classList.contains("light") ? "light" : "dark";
}

window.addPhoto = () => {
  const imageInput = document.getElementById("image");
  const dateInput = document.getElementById("date");
  const descInput = document.getElementById("desc");
  const btn = document.getElementById("addPhotoBtn");
  const progressBar = document.getElementById("uploadProgressBar");
  const file = imageInput.files[0];
  if (!file) return alert("Ø§Ø®ØªØ± ØµÙˆØ±Ø©");
  btn.disabled = true;
  document.getElementById("uploadProgressContainer").style.display = "block";
  const r = new FileReader();
  r.onprogress = (e) => { if (e.lengthComputable) progressBar.style.width = (e.loaded / e.total) * 100 + "%"; };
  r.onload = async () => {
    await addDoc(collection(db, "images"), { img: r.result, date: dateInput.value, desc: descInput.value, createdAt: Date.now() });
    document.getElementById("uploadStatus").style.display = "block";
    setTimeout(() => {
      imageInput.value = ""; dateInput.value = ""; descInput.value = "";
      btn.disabled = false;
      document.getElementById("uploadProgressContainer").style.display = "none";
      document.getElementById("uploadStatus").style.display = "none";
      toggleAdd(); loadPhotos();
    }, 1500);
  };
  r.readAsDataURL(file);
}

async function loadPhotos() {
  gallery.innerHTML = "<p style='text-align:center'>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø°ÙƒØ±ÙŠØ§ØªÙ†Ø§...</p>";
  const snap = await getDocs(collection(db, "images"));
  let photos = [];
  snap.forEach(d => photos.push({ id: d.id, ...d.data() }));
  photos.sort((a, b) => (new Date(b.date || 0)) - (new Date(a.date || 0)) || (b.createdAt || 0) - (a.createdAt || 0));
  gallery.innerHTML = photos.length ? "" : "<p style='text-align:center'>Ù„Ø³Ù‡ Ù…ÙÙŠØ´ ØµÙˆØ± ÙŠØ§ Ø±ÙˆØ­ÙŠ</p>";
  photos.forEach((p, index) => {
    const card = document.createElement('div');
    card.className = 'card';
    card.id = `card-${p.id}`;
    card.style.animationDelay = `${index * 0.1}s`;
    card.innerHTML = `<img src="${p.img}" onclick="window.openImg('${p.img}')" loading="lazy">
      <div class="card-content">
        <div style="margin-top:8px; font-size:13px; opacity:0.8;">ğŸ“… ${p.date || "Ø¨Ø¯ÙˆÙ† ØªØ§Ø±ÙŠØ®"}</div>
        <div style="font-weight:bold; margin:5px 0;">${p.desc || ""}</div>
      </div>
      <div class="actions">
        <div class="action-btn" onclick="startEdit('${p.id}', '${p.desc}', '${p.date}')">âœï¸</div>
        <div class="action-btn" onclick="deletePhoto('${p.id}')">ğŸ—‘</div>
      </div>`;
    gallery.appendChild(card);
  });
}

window.openImg = src => {
  const v = document.createElement("div");
  v.className = "viewer"; 
  v.innerHTML = `<img src="${src}">`;
  document.body.appendChild(v);
  setTimeout(() => v.classList.add("active"), 10);
  v.onclick = () => { 
    v.classList.remove("active");
    v.classList.add("closing");
    setTimeout(() => v.remove(), 800);
  };
}

window.deletePhoto = async id => {
  if (prompt("ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ù„Ù„Ù…Ø³Ø­") !== REAL_PASSWORD) return alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ØºÙ„Ø·");
  await deleteDoc(doc(db, "images", id)); loadPhotos();
}

window.startEdit = (id, oldDesc, oldDate) => {
  if (prompt("ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ù„Ù„ØªØ¹Ø¯ÙŠÙ„") !== REAL_PASSWORD) return alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ØºÙ„Ø·");
  const card = document.getElementById(`card-${id}`);
  card.querySelector('.card-content').innerHTML = `
    <input type="text" id="edit-desc-${id}" value="${oldDesc}" placeholder="Ø§Ù„ÙˆØµÙ">
    <input type="date" id="edit-date-${id}" value="${oldDate}">
    <button onclick="saveEdit('${id}')" style="background:var(--gold); color:#000; margin-top:5px;">Ø­ÙØ¸ âœ…</button>
  `;
}

window.saveEdit = async (id) => {
  const newDesc = document.getElementById(`edit-desc-${id}`).value;
  const newDate = document.getElementById(`edit-date-${id}`).value;
  await updateDoc(doc(db, "images", id), { desc: newDesc, date: newDate });
  loadPhotos();
}
</script>
</body>
</html>
