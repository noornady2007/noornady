<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SHAHDâ™¡NOOR</title>

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">

<style>
:root{
  --bg1:#3c096c;
  --bg2:#5a189a;
  --bg3:#240046;
  --glass:rgba(255,255,255,.16);
  --text:#fff;
  --btn:#e0aaff;
  --btnText:#240046;
  --gold: #d4af37;
}

body{
  margin:0;
  font-family:'Cairo',sans-serif;
  color:var(--text);
  min-height:100vh;
  background:
    radial-gradient(circle at top left,#7b2cbf55,transparent 45%),
    radial-gradient(circle at bottom right,#ffafcc33,transparent 45%),
    linear-gradient(135deg,var(--bg1),var(--bg2),var(--bg3));
  transition:background 1s ease;
  overflow-x: hidden;
  position: relative;
}

body.light{
  --bg1:#ffe5ff;
  --bg2:#e0aaff;
  --bg3:#c77dff;
  --text:#3c096c;
}

/* ===== Header ===== */
.header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:14px;
  position: relative;
  z-index: 10;
}

.icon-btn{
  width:42px;height:42px;
  border-radius:14px;
  background:rgba(255,255,255,.25);
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
}

.header-title{
  font-weight:700;
  font-size:20px;
}

/* ===== Counter Styling ===== */
.counter-wrapper {
  position: relative;
  padding: 20px 0;
}

.counter-container {
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(10px);
  margin: 0 16px;
  padding: 20px;
  border-radius: 25px;
  text-align: center;
  border: 2px solid rgba(212, 175, 55, 0.6);
  box-shadow: 0 0 20px rgba(212, 175, 55, 0.2);
  position: relative;
  z-index: 2;
}

.bg-heart {
  position: absolute;
  font-size: 18px;
  animation: pulseHeart 2s infinite ease-in-out;
  color: #ff4d6d;
  opacity: 0.6;
}

@keyframes pulseHeart {
  0%, 100% { transform: scale(1); opacity: 0.4; }
  50% { transform: scale(1.3); opacity: 0.8; }
}

.counter-title {
  font-size: 16px;
  margin-bottom: 15px;
  font-weight: bold;
  color: #fff;
}

.counter-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 5px;
}

.counter-item {
  display: flex;
  flex-direction: column;
  background: rgba(255,255,255,0.05);
  padding: 8px 2px;
  border-radius: 12px;
}

.counter-val {
  font-size: 18px;
  font-weight: 900;
  color: var(--gold);
}

.counter-label {
  font-size: 10px;
  font-weight: 700;
  color: #ddd;
}

/* ===== Containers ===== */
.container{
  max-width:430px;
  margin:auto;
  padding:16px;
  position: relative;
  z-index: 5;
}

.hidden{display:none}

input,textarea,button{
  width:100%;
  padding:14px;
  margin:8px 0;
  border-radius:14px;
  border:none;
  font-family:inherit;
  box-sizing: border-box;
}

input,textarea{
  background:rgba(255,255,255,.25);
  color:#fff;
}

button{
  background:var(--btn);
  color:var(--btnText);
  font-weight:700;
  cursor: pointer;
}

/* ===== Add Box ===== */
#addBox{
  overflow:hidden;
  transition:.6s ease;
}
#addBox.hide{max-height:0;opacity:0;transform:translateY(-20px)}
#addBox.show{max-height:500px;opacity:1;transform:translateY(0)}

/* ===== Cards ===== */
.card{
  background:var(--glass);
  backdrop-filter:blur(18px);
  border-radius:20px;
  padding:12px;
  margin-top:18px;
  animation:fadeIn .8s ease;
}

@keyframes fadeIn{
  from{opacity:0;transform:scale(.95)}
  to{opacity:1;transform:scale(1)}
}

.card img{
  width:100%;
  border-radius:14px;
  cursor:pointer;
  transition:.4s ease;
}

/* Ø§Ù„Ù‚Ù„ÙˆØ¨ Ø§Ù„Ø·Ø§Ø¦Ø±Ø© */
.heart-pop{
  position:fixed;
  color:#ff4d6d;
  font-size:24px;
  pointer-events:none;
  z-index: 9999;
  animation:popOut 1.2s ease-out forwards;
}

@keyframes popOut{
  0%{ transform: translate(-50%, -50%) scale(0.5); opacity: 1; }
  100%{ transform: translate(-50%, -200px) scale(1.5) rotate(20deg); opacity: 0; }
}

.love-text-pop{
  position:fixed;
  font-size:16px;
  color:#fff;
  font-weight:700;
  text-shadow: 0 0 10px #ff4d6d;
  pointer-events:none;
  z-index: 9999;
  animation:textFloatUp 1.5s ease-out forwards;
  white-space: nowrap;
}

@keyframes textFloatUp {
  0% { transform: translate(-50%, -50%); opacity: 1; }
  100% { transform: translate(-50%, -120px); opacity: 0; }
}

.actions{ display:flex; gap:8px; margin-top:8px; }
.action-btn{ width:36px; height:36px; border-radius:12px; background:#fff; display:flex; align-items:center; justify-content:center; cursor:pointer; }
.viewer{ position:fixed; inset:0; background:#000c; display:flex; align-items:center; justify-content:center; z-index:10000; }
.viewer img{ max-width:90%; max-height:90%; border-radius:20px; }
</style>
</head>

<body>

<div class="header">
  <div class="icon-btn" onclick="toggleTheme()">ğŸŒ™</div>
  <div class="header-title">SHAHDâ™¡NOOR ğŸ’œ</div>
  <div class="icon-btn" onclick="toggleAdd()">â‹®</div>
</div>

<div id="login" class="container">
  <input type="password" id="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±">
  <button onclick="login()">Ø¯Ø®ÙˆÙ„</button>
</div>

<div id="app" class="container hidden">
  
  <div class="counter-wrapper">
    <div class="bg-heart" style="top:0; left:10px;">â¤ï¸</div>
    <div class="bg-heart" style="bottom:0; right:10px;">ğŸ’–</div>
    <div class="bg-heart" style="top:10px; right:15px;">ğŸ’•</div>
    <div class="bg-heart" style="bottom:5px; left:20px;">ğŸ’—</div>
    
    <div class="counter-container">
      <div class="counter-title" id="counterTitle">Ø¨Ù‚Ø§Ù„Ù†Ø§ Ù…Ø¹ Ø¨Ø¹Ø¶ ÙŠØ§ Ø±ÙˆØ­ÙŠ â¤ï¸</div>
      <div class="counter-grid" id="timer">
        <div class="counter-item"><span class="counter-val" id="months">0</span><span class="counter-label">Ø´Ù‡Ø±</span></div>
        <div class="counter-item"><span class="counter-val" id="days">0</span><span class="counter-label">ÙŠÙˆÙ…</span></div>
        <div class="counter-item"><span class="counter-val" id="hours">0</span><span class="counter-label">Ø³Ø§Ø¹Ø©</span></div>
        <div class="counter-item"><span class="counter-val" id="minutes">0</span><span class="counter-label">Ø¯Ù‚ÙŠÙ‚Ø©</span></div>
        <div class="counter-item"><span class="counter-val" id="seconds">0</span><span class="counter-label">Ø«Ø§Ù†ÙŠØ©</span></div>
      </div>
    </div>
  </div>

  <div id="addBox" class="hide">
    <input type="file" id="image" accept="image/*">
    <input type="date" id="date">
    <textarea id="desc" placeholder="ÙˆØµÙ Ø§Ù„ØµÙˆØ±Ø©"></textarea>
    <button onclick="addPhoto()">Ø¥Ø¶Ø§ÙØ© ØµÙˆØ±Ø©</button>
  </div>

  <div id="gallery"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBuSYBywG6Jn-pTaqkKEDcbYeORukEh1pU",
  authDomain: "noor-25be7.firebaseapp.com",
  projectId: "noor-25be7",
  storageBucket: "noor-25be7.firebasestorage.app",
  messagingSenderId: "245021407626",
  appId: "1:245021407626:web:e4ce8a4d4a5a160831b073"
};

const appFirebase = initializeApp(firebaseConfig);
const db = getFirestore(appFirebase);

const REAL_PASSWORD = "25102007";
// ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø±ØªØ¨Ø§Ø·: 29/11/2025 Ø§Ù„Ø³Ø§Ø¹Ø© 11:30 Ù…Ø³Ø§Ø¡Ù‹ (23:30)
const relationshipDate = new Date(2025, 10, 29, 23, 30); 

const loginDiv = document.getElementById("login");
const appDiv = document.getElementById("app");
const gallery = document.getElementById("gallery");
const addBox = document.getElementById("addBox");
let isLoggedIn = false;

window.login = () => {
  if (document.getElementById("password").value === REAL_PASSWORD) {
    loginDiv.classList.add("hidden");
    appDiv.classList.remove("hidden");
    isLoggedIn = true;
    loadPhotos();
    startCounter();
    enableGlobalHearts();
  } else alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ØºÙ„Ø·");
}

function startCounter() {
  setInterval(() => {
    const now = new Date();
    let diff = now - relationshipDate;
    let isFuture = diff < 0;
    let absDiff = Math.abs(diff);

    let totalSeconds = Math.floor(absDiff / 1000);
    let seconds = totalSeconds % 60;
    let totalMinutes = Math.floor(totalSeconds / 60);
    let minutes = totalMinutes % 60;
    let totalHours = Math.floor(totalMinutes / 60);
    let hours = totalHours % 24;
    let totalDays = Math.floor(totalHours / 24);
    
    let months = Math.floor(totalDays / 30.44);
    let days = Math.floor(totalDays % 30.44);

    document.getElementById("months").innerText = months;
    document.getElementById("days").innerText = days;
    document.getElementById("hours").innerText = hours;
    document.getElementById("minutes").innerText = minutes;
    document.getElementById("seconds").innerText = seconds;
    
    const title = document.getElementById('counterTitle');
    title.innerText = isFuture ? "Ø¨Ø§Ù‚ÙŠ Ø¹Ù„Ù‰ Ø§Ø±ØªØ¨Ø§Ø·Ù†Ø§ ÙŠØ§ Ø±ÙˆØ­ÙŠ â¤ï¸" : "Ø¨Ù‚Ø§Ù„Ù†Ø§ Ù…Ø¹ Ø¨Ø¹Ø¶ ÙŠØ§ Ø±ÙˆØ­ÙŠ â¤ï¸";
  }, 1000);
}

function enableGlobalHearts() {
  document.addEventListener('click', (e) => {
    if (!isLoggedIn) return;
    
    const heart = document.createElement('div');
    heart.className = 'heart-pop';
    heart.innerHTML = 'â¤ï¸';
    heart.style.left = e.clientX + 'px';
    heart.style.top = e.clientY + 'px';
    document.body.appendChild(heart);
    
    const text = document.createElement('div');
    text.className = 'love-text-pop';
    text.innerHTML = 'Ø¨Ø­Ø¨Ùƒ ÙŠØ§ Ø´Ù‡ÙˆØ¯ØªÙŠ ğŸ’•ğŸŒš';
    text.style.left = e.clientX + 'px';
    text.style.top = (e.clientY - 25) + 'px';
    document.body.appendChild(text);
    
    setTimeout(() => {
      heart.remove();
      text.remove();
    }, 1500);
  });
}

window.toggleAdd = () => {
  addBox.classList.toggle("show");
  addBox.classList.toggle("hide");
}

window.toggleTheme = () => {
  document.body.classList.toggle("light");
  localStorage.theme = document.body.classList.contains("light") ? "light" : "dark";
}

if (localStorage.theme === "light") document.body.classList.add("light");

window.addPhoto = () => {
  const imageInput = document.getElementById("image");
  const dateInput = document.getElementById("date");
  const descInput = document.getElementById("desc");
  
  const file = imageInput.files[0];
  if (!file) return alert("Ø§Ø®ØªØ± ØµÙˆØ±Ø©");
  
  const r = new FileReader();
  r.onload = async () => {
    try {
      await addDoc(collection(db, "images"), {
        img: r.result,
        date: dateInput.value, // Ù‡Ø°Ø§ Ù‡Ùˆ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø°ÙŠ Ø³Ù†Ø¹ØªÙ…Ø¯ Ø¹Ù„ÙŠÙ‡ ÙÙŠ Ø§Ù„ØªØ±ØªÙŠØ¨
        desc: descInput.value,
        createdAt: Date.now()
      });
      imageInput.value = "";
      dateInput.value = "";
      descInput.value = "";
      loadPhotos();
    } catch (e) {
      alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø±ÙØ¹");
    }
  };
  r.readAsDataURL(file);
}

async function loadPhotos() {
  gallery.innerHTML = "<p style='text-align:center'>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø°ÙƒØ±ÙŠØ§ØªÙ†Ø§...</p>";
  
  const snap = await getDocs(collection(db, "images"));
  let photos = [];
  snap.forEach(d => photos.push({ id: d.id, ...d.data() }));

  // ØªØ±ØªÙŠØ¨ Ø§Ù„ØµÙˆØ± Ø­Ø³Ø¨ Ø­Ù‚Ù„ Ø§Ù„ØªØ§Ø±ÙŠØ® (date) Ø§Ù„Ù…ÙƒØªÙˆØ¨ Ù…Ù† Ø§Ù„Ø£Ø­Ø¯Ø« Ù„Ù„Ø£Ù‚Ø¯Ù…
  photos.sort((a, b) => {
    const dateA = a.date ? new Date(a.date) : new Date(0);
    const dateB = b.date ? new Date(b.date) : new Date(0);
    
    // Ø¥Ø°Ø§ ØªØ³Ø§ÙˆÙ‰ Ø§Ù„ØªØ§Ø±ÙŠØ®ØŒ Ù†Ø±ØªØ¨ Ø­Ø³Ø¨ ÙˆÙ‚Øª Ø§Ù„Ø±ÙØ¹ (createdAt)
    if (dateB - dateA === 0) {
        return (b.createdAt || 0) - (a.createdAt || 0);
    }
    return dateB - dateA;
  });

  gallery.innerHTML = "";
  if(photos.length === 0) gallery.innerHTML = "<p style='text-align:center'>Ù„Ø³Ù‡ Ù…ÙÙŠØ´ ØµÙˆØ± ÙŠØ§ Ø±ÙˆØ­ÙŠ</p>";

  photos.forEach(p => {
    const card = document.createElement('div');
    card.className = 'card';
    card.innerHTML = `
      <img src="${p.img}" onclick="openImg('${p.img}')" loading="lazy">
      <div style="margin-top:8px; font-size:13px; opacity:0.8;">ğŸ“… ${p.date || "Ø¨Ø¯ÙˆÙ† ØªØ§Ø±ÙŠØ®"}</div>
      <div style="font-weight:bold; margin:5px 0;">${p.desc || ""}</div>
      <div class="actions">
        <div class="action-btn" onclick="editPhoto('${p.id}')">âœï¸</div>
        <div class="action-btn" onclick="deletePhoto('${p.id}')">ğŸ—‘</div>
      </div>
    `;
    gallery.appendChild(card);
  });
}

window.openImg = src => {
  const v = document.createElement("div");
  v.className = "viewer";
  v.innerHTML = `<img src="${src}">`;
  v.onclick = () => v.remove();
  document.body.appendChild(v);
}

window.deletePhoto = async id => {
  if (prompt("ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ù„Ù„Ù…Ø³Ø­") !== REAL_PASSWORD) return;
  await deleteDoc(doc(db, "images", id));
  loadPhotos();
}

window.editPhoto = async id => {
  if (prompt("ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ù„Ù„ØªØ¹Ø¯ÙŠÙ„") !== REAL_PASSWORD) return;
  const d = prompt("Ø§Ù„ÙˆØµÙ Ø§Ù„Ø¬Ø¯ÙŠØ¯");
  const dt = prompt("Ø§Ù„ØªØ§Ø±ÙŠØ® (YYYY-MM-DD)");
  if (d !== null) {
    await updateDoc(doc(db, "images", id), { desc: d, date: dt });
    loadPhotos();
  }
}
</script>

</body>
</html>

